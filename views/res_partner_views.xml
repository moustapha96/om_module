<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extension de la vue formulaire des partenaires -->
    <record id="view_res_partner_form_orange_money" model="ir.ui.view">
        <field name="name">res.partner.form.orange.money</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form" />
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="Orange Money" name="orange_money">

                    <!-- Affichage du champ MSISDN -->
                    <group>
                        <field name="orange_money_msisdn" />
                    </group>

                    <!-- Ajout d'un champ pour afficher les transactions Orange Money -->
                    <field name="orange_money_transaction_ids" readonly="1">
                        <tree decoration-success="status == 'SUCCESS'"
                            decoration-info="status in ['INITIATED', 'PENDING', 'ACCEPTED']"
                            decoration-danger="status in ['FAILED', 'REJECTED']"
                            decoration-warning="status == 'CANCELLED'">
                            <field name="reference" />
                            <field name="transaction_id" />
                            <field name="amount" />
                            <field name="status" widget="badge" />
                            <field name="created_at" />
                            <field name="completed_at" />
                            <!-- Bouton pour actualiser le statut de la transaction -->
                            <button name="action_refresh_status" type="object"
                                string="Actualiser" icon="fa-refresh"
                                attrs="{'invisible': [('status', 'in', ['SUCCESS', 'FAILED', 'REJECTED', 'CANCELLED'])]}" />
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>